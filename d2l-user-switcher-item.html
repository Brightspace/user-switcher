<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-icons/d2l-icons.html">
<link rel="import" href="../d2l-menu/d2l-menu-item-behavior.html">
<link rel="import" href="../d2l-menu/d2l-menu-item-styles.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">
<link rel="import" href="../d2l-hm-constants-behavior/d2l-hm-constants-behavior.html">
<link rel="import" href="../d2l-organization-hm-behavior/d2l-organization-hm-behavior.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../d2l-user-profile-behavior/d2l-user-profile-behavior.html">
<link rel="import" href="../d2l-image/d2l-image.html">

<dom-module id="d2l-user-switcher-item">
	<template>
		<style include="d2l-menu-item-styles">
			.d2l-user-switcher-item-link {
				text-decoration: none;
			}
			.d2l-user-switcher-item-container {
				display: flex;
				margin: 10px 30px;
			}
			.d2l-user-switcher-item-image {
				max-width: 42px;
				max-height: 42px;
				margin-right:15px;
				border-radius: 6px;
			}
			.d2l-user-switcher-item-info p, .d2l-user-switcher-item-info h2 {
				text-decoration: none;
				font-weight: normal;
			}
			.d2l-user-switcher-item-name {
				margin: -3px 0 0 0;
				font-size: 19px;
				line-height: 24px;
				font-weight: normal;
				color: var(--d2l-color-celestine);
			}
			.d2l-user-switcher-item-school {
				color: var(--d2l-color-ferrite);
				margin: 0;
				font-size: 16px;
				line-height:  24px;
			}

			.user-tile-default-icon {
				--d2l-icon-height: 100%;
				--d2l-icon-width: 100%;
			}
		</style>


		<a href="javascript:void(0);" class="d2l-user-switcher-item-link d2l-user-switcher-item-container" tabindex="-1">
			<div class="d2l-user-switcher-item-image">
				<template is="dom-if" if="{{_hideCustomIcon(_iconUrl)}}">
					<d2l-icon icon="d2l-tier1:profile-pic" class="user-tile-default-icon"></d2l-icon>
				</template>
				<template is="dom-if" if="{{!_hideCustomIcon(_iconUrl)}}">
					<d2l-image image-url="[[_iconUrl]]" token="[[token]]"></d2l-image>
				</template>
			</div>
			<div class="d2l-user-switcher-item-info">
				<h2 class="d2l-user-switcher-item-name">{{_name}}</h2>
				<p class="d2l-user-switcher-item-school">{{_school}}</p>
			</div>
		</a>
	</template>
	<script src="https://s.brightspace.com/lib/ifrau/0.19.0/ifrau/client.js"></script>
	<script>
		'use strict';

		Polymer({
			is: 'd2l-user-switcher-item',

			behaviors: [
				window.D2L.PolymerBehaviors.MenuItemBehavior,
				window.D2L.Hypermedia.HMConstantsBehavior,
				window.D2L.UserProfileBehavior
			],
			observers: [
				'_onUserChange( userUrl, token )'
			],
			properties: {
				token: {
					type: String,
					value: null
				},
				userUrl: String
			},

			ready: function() {
				this.generateUserRequest(this.userUrl, this.token);
			},
			_onUserChange: function() {
				this.generateUserRequest(this.userUrl, this.token);
			},
			_hideCustomIcon: function(icon) {
				return !icon;
			}
		});
	</script>
</dom-module>
